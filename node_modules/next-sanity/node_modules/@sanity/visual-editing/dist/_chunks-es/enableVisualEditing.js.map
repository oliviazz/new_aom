{"version":3,"file":"enableVisualEditing.js","sources":["../../src/constants.ts","../../src/ui/enableVisualEditing.tsx"],"sourcesContent":["export { VERCEL_STEGA_REGEX } from '@vercel/stega'\n\nexport const OVERLAY_ID = 'sanity-visual-editing'\n","import type { Root } from 'react-dom/client'\n\nimport { OVERLAY_ID } from '../constants'\nimport type { DisableVisualEditing, VisualEditingOptions } from '../types'\n\nlet node: HTMLElement | null = null\nlet root: Root | null = null\nlet cleanup: number | null = null\n\n/**\n * Enables Visual Editing overlay in a page with sourcemap encoding.\n *\n * This will overlay UI on hovered elements that deep-links to Sanity Studio.\n * @public\n */\nexport function enableVisualEditing(\n  options: VisualEditingOptions = {},\n): DisableVisualEditing {\n  if (cleanup) clearTimeout(cleanup)\n  const controller = new AbortController()\n\n  // Lazy load everything needed to render the app\n  Promise.all([import('react-dom/client'), import('./VisualEditing')]).then(\n    ([reactClient, { VisualEditing }]) => {\n      if (controller.signal.aborted) return\n\n      if (!node) {\n        node = document.createElement('div')\n        node.id = OVERLAY_ID\n        document.body.appendChild(node)\n      }\n\n      if (!root) {\n        const { createRoot } =\n          'default' in reactClient ? reactClient.default : reactClient\n        root = createRoot(node)\n      }\n\n      root.render(\n        <>\n          <VisualEditing {...options} />\n        </>,\n      )\n    },\n  )\n\n  return () => {\n    controller.abort()\n    // Handle React StrictMode, delay cleanup for a second in case it's a rerender\n    cleanup = window.setTimeout(() => {\n      if (root) {\n        root.unmount()\n        root = null\n      }\n      if (node) {\n        document.body.removeChild(node)\n        node = null\n      }\n    }, 1000)\n  }\n}\n"],"names":["jsx","Fragment","OVERLAY_ID","node","root","cleanup","enableVisualEditing","options","clearTimeout","controller","AbortController","Promise","all","import","then","reactClient","VisualEditing","signal","aborted","document","createElement","id","body","appendChild","createRoot","default","render","children","abort","window","setTimeout","unmount","removeChild"],"mappings":"cAEOA,cAAAC,MAAA,oBAAA,MAAMC,EAAa,wBCG1B,IAAIC,EAA2B,KAC3BC,EAAoB,KACpBC,EAAyB,KAQb,SAAAC,EACdC,EAAgC,IAE5BF,GAASG,aAAaH,GACpB,MAAAI,EAAa,IAAIC,gBAGf,OAAAC,QAAAC,IAAI,CAACC,OAAO,oBAAqBA,OAAO,wBAAqBC,MACnE,EAAEC,GAAeC,qBACX,IAAAP,EAAWQ,OAAOC,QAQtB,CAAA,GANKf,IACHA,EAAOgB,SAASC,cAAc,OAC9BjB,EAAKkB,GAAKnB,EACViB,SAASG,KAAKC,YAAYpB,KAGvBC,EAAM,CACT,MAAMoB,WAAEA,GACN,YAAaT,EAAcA,EAAYU,QAAUV,EACnDX,EAAOoB,EAAWrB,EACpB,CAEKC,EAAAsB,OAED1B,EAAAC,EAAA,CAAA0B,SAAA3B,EAACgB,EAAe,IAAGT,MAEvB,KAIG,KACLE,EAAWmB,QAEXvB,EAAUwB,OAAOC,YAAW,KAExB1B,IAAAA,EAAK2B,UACL3B,EAAO,MAELD,IACFgB,SAASG,KAAKU,YAAY7B,GAC1BA,EAAO,KAAA,GAER,IAAI,CAEX"}